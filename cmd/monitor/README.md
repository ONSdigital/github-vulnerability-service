# Vulnerability monitor

Queries the `graphql` endpoint of the github API to glean information about
open vulnerabilities on repositories belonging to a user or team.

## Setup

Supports the following env vars

| ENV          | Example          | Description                                                |
|--------------|------------------|------------------------------------------------------------|
| CRONTAB      | `0 6 * * *`      | Defines schedule to perform checks                         |
| TOKEN        | `ja9c8dd8sdc...` | Github access token for authenticating to the graph API    |
| GITHUB_ORG   | `ONSdigital`     | Name of the github organisation to which your team belongs |
| GITHUB_TEAM  | `my-team`        | The slug (name or id) of your team                         |
| GITHUB_USER  | `myuser`         | Username of the user of which to monitor repos             |

`TOKEN` and `CRONTAB` are always required

If you wish to check repositories for an organisation team then `GITHUB_ORG` and `GITHUB_TEAM` must be set. Otherwise `GITHUB_USER` must be set instead.

## API

Provides the following endpoints

| Endpoint  | Method | Returns                                                          |
|-----------|--------|------------------------------------------------------------------|
| `/info`   | GET    | Current health status of the app and last time checking occurred |
| `/report` | GET    | Current vulnerability report as of last time cron ran            |

## Running on Cloud Foundry

Build with:

```shell
GOOS=linux GOARCH=amd64 go build -o ./bin/monitor cmd/monitor/main.go
```

Example manifest:

```yml
applications:
- name: github-vuln-monitor
  instances: 1
  memory: 256M
  buildpack: binary_buildpack
  command: ./bin/monitor
  env:
    GITHUB_ORG: ONSdigital
    GITHUB_TEAM: some-team
    TOKEN: <redacted>
    CRONTAB: "0 6 * * *"
```